/*******************************************************************************/
/* Generated by Zelix KlassMaster 15.0.2 ZKM Script Helper 2020.12.23 15:28:00 */
/*******************************************************************************/

classpath   "lib\*.jar"
            "jre8x64\lib\*.jar"
            "target\lib\*.jar";

open        "target\bms.server.debug.jar";

trimExclude // 入口
            org.bms.BMS^ public static main(java.lang.String[])
            // 含有纯脚本调用的方法
            and org.bms.scripting..*^ *(*)
            and org.bms.client.character.stats..* *(*)
            and org.bms.client.character.Character *(*)
            and org.bms.client.character.MapleClient *(*)
            and org.bms.client.inventory..* *(*)
            and org.bms.common.cache.ItemInfoCache *(*)
            and org.bms.server.maps..* *(*)
            and org.bms.server.MapleStorage public *(*)
            and org.bms.server.life.AbstractLoadedLife public *(*)
            and org.bms.server.life.mob.Monster public *(*)
            and org.bms.server.life.mob.MonsterStats public *(*)
            and org.bms.server.life.mob.ChangeableStats public *(*)
            and org.bms.server.life.mob.OverrideMonsterStats public *(*)
            and org.bms.server.world.MapleParty public *(*)
            and org.bms.server.world.MaplePartyCharacter public *(*)
            // 反射调用要用到
            and org.bms.server..* public getInstance()
            // 用于Virbox后续虚拟化
            and @virbox.VBVirtualize
            // 指令
            and org.bms.server.commands..* extends org.bms.server.commands.AbstractCommandExecutor
            and org.bms.server.commands..* public getPlayerLevelRequired(*)
            // 本地方法
            and *.^*^ native *(*)
            ;

// 影响到类、包、注解等的清理
trim        deleteSourceFileAttributes=true
            deleteDeprecatedAttributes=true
            deleteAnnotationAttributes=true
            deleteExceptionAttributes=true
            deleteUnknownAttributes=true;

stringEncryptionExclude
            // 枚举类过大导致混淆后字节码长度超过65535，只能屏蔽字符串加密
            org.bms.handling.opcode.RecvPacketOpcode
            and org.bms.handling.opcode.SendPacketOpcode
            ;

// 这项配置只影响到名称的混淆
exclude     // 入口
            org.bms.^BMS^ public static main(java.lang.String[])
            // 脚本方法
            and org.bms.scripting..* public *(*)
            and org.bms.client.character.stats..* public *(*)
            and org.bms.client.character.Character public *(*)
            and org.bms.client.character.MapleClient public *(*)
            and org.bms.client.inventory..* public *(*)
            and org.bms.common.cache.ItemInfoCache public *(*)
            and org.bms.server.maps..* public *(*)
            and org.bms.server.MapleStorage public *(*)
            and org.bms.server.life.AbstractLoadedLife public *(*)
            and org.bms.server.life.mob.Monster public *(*)
            and org.bms.server.life.mob.MonsterStats public *(*)
            and org.bms.server.life.mob.ChangeableStats public *(*)
            and org.bms.server.life.mob.OverrideMonsterStats public *(*)
            and org.bms.server.world.MapleParty public *(*)
            and org.bms.server.world.MaplePartyCharacter public *(*)
            and org.bms.common.database.DBRecord public *(*)
            // 反射调用要用到
            and org.bms.server..* public getInstance()
            // 混淆后太大了
            and org.bms.client.stat..* public *(*)
            // JSON配置项，包括其getter、setter方法
            and org.bms.common.dto.*^ public *
            and org.bms.common.dto.* public *(*)
            // 枚举名称，用于配置项或常规输出信息
            and org.bms.common.enums.keepnames.* public *
            and org.bms.client.buffstat.MapleBuffStat public *
            and org.bms.client.buffstat.MapleDiseaseType public *
            and org.bms.server.MapleStatInfo public *
            and org.bms.common.log.FileLogger public *
            // 用于Virbox标注虚拟化
            and virbox.
            and virbox.VBVirtualize
            // 怪物自定义属性名称，没有getter、setter，方便脚本里直接调用
            and org.bms.server.life.mob.ChangeableStats public *
            // 指令
            and org.bms.server.commands..* extends org.bms.server.commands.AbstractCommandExecutor
            and org.bms.server.commands..* extends org.bms.server.commands.AbstractCommandExecutor getPlayerLevelRequired()
            // 本地方法
            and *.^*^ native *(*)
            // 【测试用，保留所有包名类名】
            // and *.^*
            ;

classInitializationOrder org.bms.BMS > org.bms.client.character.Character
            ;

// 第一步，先不进行方法内部的复杂混淆，免得Virbox不支持
obfuscate   changeLogFileIn=""
            changeLogFileOut="ZKM混淆记录/变更日志_至尊版_237.4.10.txt"
            aggressiveMethodRenaming=true
            keepInnerClassInfo=ifNameNotObfuscated
            obfuscateFlow=aggressive
            exceptionObfuscation=heavy
            encryptStringLiterals=enhanced
            mixedCaseClassNames=ifInArchive
            lineNumbers=delete
            localVariables=delete
            methodParameters=keepVisibleIfNotObfuscated
            hideFieldNames=true
            hideStaticMethodNames=true
            randomize=true
            obfuscateReferences=none
            autoReflectionHandling=normal
            methodParameterChanges=none
            obfuscateParameters=normal
            collapsePackagesWithDefault="org/bms"
            keepBalancedLocks=true
            ;

saveAll     archiveCompression=all "target\bms.server.tmp.jar";