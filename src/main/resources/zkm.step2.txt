/*******************************************************************************/
/* Generated by Zelix KlassMaster 15.0.2 ZKM Script Helper 2020.12.23 15:28:00 */
/*******************************************************************************/

classpath   "lib\*.jar"
            "jre8x64\lib\*.jar"
            "target\lib\*.jar";

open        "target\bms.server.ssp.jar";

// 只移除Virbox相关内容
trimExclude *.*^ *
            and *.*^ *(*)
            ;

trimUnexclude @virbox.VBVirtualize
            and virbox.VBVirtualize
            ;

trim        deleteAnnotationAttributes=true;

// 保留所有包名类名方法名，免得虚拟化里的方法找不到对象
exclude     *.^*^ *
            and *.*^ *(*)
            ;

methodParameterChangesExclude
            // 避免脚本方法被增加一些奇怪的参数
            org.bms.scripting..* public *(*)
            and org.bms.client.character.stats..* public *(*)
            and org.bms.client.character.Character public *(*)
            and org.bms.client.character.MapleClient public *(*)
            and org.bms.client.inventory..* public *(*)
            and org.bms.common.cache.ItemInfoCache public *(*)
            and org.bms.server.maps..* public *(*)
            and org.bms.server.life.AbstractLoadedLife public *(*)
            and org.bms.server.life.mob.Monster public *(*)
            and org.bms.server.life.mob.MonsterStats public *(*)
            and org.bms.server.life.mob.ChangeableStats public *(*)
            and org.bms.server.life.mob.OverrideMonsterStats public *(*)
            and org.bms.server.world.MapleParty public *(*)
            and org.bms.server.world.MaplePartyCharacter public *(*)
            and org.bms.common.database.DBRecord public *(*)
            ;

classInitializationOrder org.bms.BMS > org.bms.client.character.Character
            ;

obfuscateReferencesInclude
            // 确保里面的方法都被反射混淆
            org.bms.server.lifecycle.StartServer public *(*)
            and org.bms.common.verify.SslClient public *(*)
            and org.bms.common.verify.验证机房地址 public *(*)
            and org.bms.packet.io.PacketWriter public PacketWriter(*)
            and org.bms.handling.netty.MaplePacketEncoder public getCode(*)
            and org.bms.handling.netty.MaplePacketDecoder public getCode(*)
            ;

// 第二步，只混淆方法内部，不混淆接口名称，免得找不到日志
obfuscate   changeLogFileIn=""
            changeLogFileOut=""
            aggressiveMethodRenaming=false
            keepInnerClassInfo=true
            obfuscateFlow=none
            exceptionObfuscation=none
            encryptStringLiterals=none
            mixedCaseClassNames=false
            lineNumbers=keep
            localVariables=keep
            methodParameters=keep
            hideFieldNames=false
            hideStaticMethodNames=false
            randomize=false
            obfuscateReferences=normal
            obfuscateReferenceStructures=inSpecialClass
            obfuscateReferencesPackage="org/bms"
            autoReflectionHandling=none
            methodParameterChanges=none
            obfuscateParameters=none
            keepBalancedLocks=false
            ;

saveAll     archiveCompression=all "target\bms.server.jar";